---
import { STEAM } from '@/lib/constants'
import { processGames } from '@/lib/services/steam'
import type { OwnedGamesResponse } from '@/types/steam'

export interface Props {
	data: OwnedGamesResponse
}

const { data } = Astro.props

// Validate props
if (!data?.games) {
	throw new Error('Steam data is missing or invalid')
}

// Process games using service layer
const games = processGames(data.games)
---

<section class="flex flex-col gap-4">
	<h2 class="text-2xl font-semibold text-white text-center sm:text-left">
		ğŸ® Steamãƒ©ã‚¤ãƒ–ãƒ©ãƒª
	</h2>

	<div
		class="flex-1 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 gap-3 sm:gap-4 md:overflow-auto"
	>
		{
			games.map((game, index) => (
				<a
					href={`${STEAM.STORE_URL}${game.appid}`}
					target="_blank"
					rel="noopener noreferrer"
					class="grid grid-cols-subgrid gap-2 card-base p-2 sm:p-3 shadow"
					style={
						index >= 6
							? 'content-visibility: auto; contain-intrinsic-size: auto 120px;'
							: ''
					}
				>
					<img
						src={`${STEAM.CDN_URL}${game.appid}/capsule_184x69.jpg`}
						srcset={`${STEAM.CDN_URL}${game.appid}/capsule_184x69.jpg 184w, ${STEAM.CDN_URL}${game.appid}/capsule_231x87.jpg 231w`}
						sizes="(max-width: 640px) 184px, 231px"
						alt={game.name}
						class="rounded-md w-full"
						style="aspect-ratio: 231 / 87;"
						loading={index < 6 ? 'eager' : 'lazy'}
						decoding="async"
						fetchpriority={index < 6 ? 'high' : 'low'}
						width="231"
						height="87"
					/>
					<div>
						<h3 class="text-xs sm:text-sm font-semibold text-white truncate">
							{game.name}
						</h3>
						<p class="text-[10px] sm:text-xs text-gray-400">
							åˆè¨ˆãƒ—ãƒ¬ã‚¤æ™‚é–“:{' '}
							{(game.playtime_forever / STEAM.MINUTES_PER_HOUR).toFixed(1)} æ™‚é–“
						</p>
					</div>
				</a>
			))
		}
	</div>
</section>
