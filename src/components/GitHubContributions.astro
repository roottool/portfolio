---
import { processContributions } from '@/lib/utils/contributions'
import type { OssContribution } from '@/types/github'

export interface Props {
	data: OssContribution[]
}

const { data } = Astro.props

// Validate props
if (!data || !Array.isArray(data)) {
	throw new Error('GitHub contributions data is missing or invalid')
}

// Process contributions
const formattedContributions = processContributions(data)
---

<section class="flex flex-col gap-4">
	<h2 class="text-2xl font-semibold text-white text-center sm:text-left">
		ðŸ§© OSSã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
	</h2>

	<div class="grid grid-rows-subgrid grid-cols-1 gap-4 md:overflow-auto">
		{formattedContributions.map((contrib) => (
			<a
				href={contrib.url}
				target="_blank"
				rel="noopener noreferrer"
				class="grid gap-2 card-base p-4"
			>
				<div class="overflow-hidden">
					<h3 class="text-sm sm:text-base font-semibold text-white truncate">
						{contrib.title}
					</h3>
					<p class="text-xs sm:text-sm text-gray-400 line-clamp-2 truncate">
						{contrib.repository.nameWithOwner}
					</p>
				</div>
				<p class="text-xs text-gray-400">
					#{contrib.number} â€¢ {contrib.closedAtFmt}
				</p>
			</a>
		))}
	</div>
</section>
