---
import { config } from '@/lib/config'
import { processPullRequests } from '@/lib/services/github'
import type { IssuesSearchResponse } from '@/types/github'

export interface Props {
	data: IssuesSearchResponse
}

const { data } = Astro.props

// Validate props
if (!data?.items) {
	throw new Error('GitHub data is missing or invalid')
}

// Process pull requests using service layer
const mergedPrsInDesc = processPullRequests(data.items, config.github.username)
---

<section class="flex flex-col gap-4">
	<h2 class="text-2xl font-semibold text-white text-center sm:text-left">
		ðŸ§© OSS ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
	</h2>

	<div class="grid grid-rows-subgrid grid-cols-1 gap-4 md:overflow-auto">
		{
			mergedPrsInDesc.map((pr) => {
				const repoName = pr.repository_url.split('/').slice(-2).join('/')
				return (
					<a
						href={pr.html_url}
						target="_blank"
						rel="noopener noreferrer"
						class="grid gap-2 card-base p-4"
					>
						<div class="overflow-hidden">
							<h3 class="text-sm sm:text-base font-semibold text-white truncate">
								{pr.title}
							</h3>
							<p class="text-xs sm:text-sm text-gray-400 line-clamp-2 truncate">
								{repoName}
							</p>
						</div>
						<p class="text-xs text-gray-500">
							#{pr.number} â€¢ {pr.mergedAtFmt}
						</p>
					</a>
				)
			})
		}
	</div>
</section>
